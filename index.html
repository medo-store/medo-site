
<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Medo Gaming Store</title>

  <style>
    :root{
      --bg0:#070A12;
      --bg1:#0B1230;
      --panel:#0E183B;
      --card:#0C1736;
      --text:#F6F7FF;
      --muted:#B9C1D9;
      --border:rgba(255,255,255,.10);
      --accent:#E11D48;
      --accent2:#38BDF8;
      --good:#22C55E;
      --warn:#F59E0B;

      --radius:14px;
      --shadow: 0 12px 30px rgba(0,0,0,.35);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:"Segoe UI", Tahoma, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 500px at 15% 8%, rgba(56,189,248,.16), transparent 60%),
        radial-gradient(900px 600px at 85% 0%, rgba(225,29,72,.14), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg0));
      min-height:100vh;
    }
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:10px 12px}

    /* Sticky header */
    .nav{
      position:sticky;top:0;z-index:60;
      background:rgba(7,10,18,.72);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .nav-inner{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .brand{display:flex;align-items:center;gap:10px;font-weight:900;letter-spacing:.2px;white-space:nowrap}
    .dot{
      width:10px;height:10px;border-radius:999px;
      background:linear-gradient(135deg,var(--accent),var(--accent2));
      box-shadow:0 0 0 4px rgba(56,189,248,.10);
    }

    .searchWrap{flex:1;min-width:220px;display:flex;align-items:center;gap:8px}
    .search{
      flex:1;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
    }

    .iconBtn{
      display:inline-flex;align-items:center;justify-content:center;
      gap:8px;
      padding:10px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      cursor:pointer;
      user-select:none;
    }
    .iconBtn:hover{filter:brightness(1.08)}
    .rightBox{margin-inline-start:auto;display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .pillCount{
      min-width:22px;height:22px;border-radius:999px;
      display:inline-flex;align-items:center;justify-content:center;
      background:rgba(56,189,248,.16);
      border:1px solid rgba(56,189,248,.35);
      font-weight:900;font-size:12px;padding:0 6px;
    }

    .userChip{
      display:inline-flex;align-items:center;gap:8px;
      padding:9px 10px;border-radius:999px;
      border:1px solid rgba(56,189,248,.35);
      background:rgba(56,189,248,.10);
      cursor:pointer;white-space:nowrap;
      font-weight:900;font-size:13px;
    }
    .avatarSmall{
      width:22px;height:22px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.07);
      display:inline-flex;align-items:center;justify-content:center;
      overflow:hidden;
      font-size:11px;
    }
    .avatarSmall img{width:100%;height:100%;object-fit:cover}

    /* Sections */
    .sectionTitle{
      margin:18px 0 8px;
      font-size:15px;
      font-weight:900;
      display:flex;align-items:center;gap:10px;
    }
    .sectionHint{color:var(--muted);font-weight:800;font-size:12px}
    .spacer{height:18px}

    /* Grid */
    .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:12px}
    @media (max-width:1050px){ .grid{grid-template-columns:repeat(3,1fr);} }
    @media (max-width:760px){ .grid{grid-template-columns:repeat(2,1fr);} }
    @media (max-width:460px){ .grid{grid-template-columns:1fr;} }

    .card{
      background:rgba(12,23,54,.72);
      border:1px solid var(--border);
      border-radius:var(--radius);
      overflow:hidden;
      box-shadow: var(--shadow);
      display:flex;flex-direction:column;
      min-height:240px;
    }
    .thumb{
      height:96px;
      background:
        radial-gradient(180px 120px at 25% 30%, rgba(56,189,248,.22), transparent 65%),
        radial-gradient(180px 120px at 75% 0%, rgba(225,29,72,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:center;
      font-weight:900;letter-spacing:.7px;font-size:12px;
      position:relative;
    }
    .badge{
      position:absolute;top:8px;inset-inline-start:8px;
      padding:6px 8px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.25);
      font-size:11px;font-weight:900;
      display:inline-flex;gap:6px;align-items:center;
    }
    .badge.top{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.12)}
    .badge.offer{border-color:rgba(245,158,11,.35);background:rgba(245,158,11,.12)}

    .content{padding:10px 10px 12px;display:flex;flex-direction:column;gap:8px;flex:1}
    .name{margin:0;font-size:13px;font-weight:900}
    .meta{margin:0;font-size:12px;color:var(--muted);line-height:1.4}
    .priceRow{display:flex;align-items:center;justify-content:space-between;gap:8px}
    .price{margin:0;font-size:12px;font-weight:900}

    /* Actions */
    .actions{display:flex;gap:8px;margin-top:auto;flex-wrap:wrap}
    .btn{
      flex:1;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 10px;
      font-weight:900;font-size:12px;
      cursor:pointer;
      display:inline-flex;align-items:center;justify-content:center;gap:8px;
      min-width:120px;
    }
    .btn:hover{filter:brightness(1.08)}
    .btnRed{background:linear-gradient(135deg, rgba(225,29,72,1), rgba(225,29,72,.82));border-color:transparent}
    .btnBlue{background:rgba(56,189,248,.12);border-color:rgba(56,189,248,.35)}

    /* Overlay / drawer / modal */
    .overlay{position:fixed;inset:0;background:rgba(0,0,0,.58);display:none;z-index:80}
    .overlay.show{display:block}

    /* âœ… DRAWER FIX for RTL (no transform) */
    .drawer{
      position:fixed;top:0;bottom:0;
      width:min(360px, 92vw);
      background:rgba(14,24,59,.92);
      backdrop-filter: blur(10px);
      border:1px solid var(--border);
      box-shadow: var(--shadow);
      z-index:90;
      transition: right .22s ease;
      display:flex;flex-direction:column;

      right:-420px; /* hidden */
    }
    .drawer.show{ right:0; }

    .drawerHeader{
      padding:12px;border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .drawerTitle{font-weight:900}
    .drawerBody{padding:12px;overflow:auto}
    .drawerSection{margin:10px 0 16px}
    .drawerLabel{font-weight:900;margin:0 0 8px}
    .drawerList{display:flex;flex-direction:column;gap:8px}
    .linkRow{
      padding:10px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      cursor:pointer;
    }
    .linkRow:hover{filter:brightness(1.08)}
    .mini{font-size:12px;color:var(--muted);font-weight:800}

    .note{
      padding:10px 10px;border-radius:12px;border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      color:var(--muted);
      font-weight:800;font-size:12px;line-height:1.5;
    }
    .note.err{background:rgba(225,29,72,.18);border-color:rgba(225,29,72,.45);color:#fff}
    .note.ok{background:rgba(34,197,94,.14);border-color:rgba(34,197,94,.35);color:#fff}
    .note.warn{background:rgba(245,158,11,.14);border-color:rgba(245,158,11,.35);color:#fff}

    .modal{position:fixed;inset:0;display:none;z-index:95;align-items:center;justify-content:center;padding:14px}
    .modal.show{display:flex}
    .modalBox{
      width:min(720px, 96vw);
      background:rgba(14,24,59,.94);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .modalHeader{
      padding:12px;border-bottom:1px solid var(--border);
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }
    .modalTitle{font-weight:900}
    .modalBody{padding:12px}
    .stack{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .row > *{flex:1}
    .row .tight{flex:0 0 auto}

    .input{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
    }
    .select{
      width:100%;
      padding:11px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--text);
      outline:none;
      font-weight:900;
    }

    /* Cart */
    .cartItem{
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      border-radius:14px;
      padding:10px;
      display:flex;align-items:flex-start;justify-content:space-between;gap:10px;
    }
    .cartLeft{display:flex;gap:10px;flex:1}
    .cartThumb{
      width:54px;height:54px;border-radius:14px;
      border:1px solid var(--border);
      background:
        radial-gradient(40px 30px at 20% 20%, rgba(56,189,248,.25), transparent 65%),
        radial-gradient(40px 30px at 80% 0%, rgba(225,29,72,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      overflow:hidden;
      flex:0 0 auto;
      display:flex;align-items:center;justify-content:center;
      font-weight:900;font-size:11px;opacity:.9;
    }
    .cartName{font-weight:900;font-size:13px;margin:0 0 4px}
    .cartMeta{margin:0;color:var(--muted);font-size:12px;font-weight:800}
    .qtyRow{display:flex;gap:8px;align-items:center;margin-top:8px;flex-wrap:wrap}
    .qtyBtn{
      width:34px;height:34px;border-radius:10px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.05);
      color:var(--text);
      font-weight:900;
      cursor:pointer;
    }
    .qtyNum{min-width:34px;text-align:center;font-weight:900}
    .removeBtn{
      border:1px solid rgba(225,29,72,.35);
      background:rgba(225,29,72,.12);
      color:rgba(246,247,255,.95);
      font-weight:900;cursor:pointer;
      padding:8px 10px;border-radius:10px;
      white-space:nowrap;
    }
    .detailsBtn{
      border:1px solid rgba(56,189,248,.35);
      background:rgba(56,189,248,.10);
      color:rgba(246,247,255,.95);
      font-weight:900;cursor:pointer;
      padding:8px 10px;border-radius:10px;
      white-space:nowrap;
    }
    .totalBar{
      margin-top:10px;
      border:1px solid rgba(56,189,248,.35);
      background:rgba(56,189,248,.10);
      border-radius:14px;
      padding:10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      cursor:pointer;
      user-select:none;
    }

    /* Gallery */
    .galleryBig{
      width:100%;
      height:220px;
      border-radius:14px;
      border:1px solid var(--border);
      background:
        radial-gradient(280px 160px at 25% 30%, rgba(56,189,248,.22), transparent 65%),
        radial-gradient(280px 160px at 75% 0%, rgba(225,29,72,.18), transparent 60%),
        linear-gradient(135deg, rgba(255,255,255,.06), rgba(255,255,255,.02));
      display:flex;align-items:center;justify-content:center;
      font-weight:900;letter-spacing:.7px;
    }
    .galleryRow{display:flex;gap:10px;flex-wrap:wrap}
    .gThumb{
      width:74px;height:54px;border-radius:12px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      display:flex;align-items:center;justify-content:center;
      cursor:pointer;font-weight:900;font-size:11px;color:rgba(246,247,255,.9);
    }
    .gThumb.active{border-color:rgba(56,189,248,.55);background:rgba(56,189,248,.10)}

    /* Footer */
    .footer{
      margin-top:18px;border-top:1px solid var(--border);
      padding:14px 0 22px;
      color:var(--muted);
      display:flex;gap:10px;flex-wrap:wrap;align-items:center;
    }
    .social{
      display:inline-flex;align-items:center;gap:8px;
      padding:9px 10px;border-radius:999px;
      border:1px solid var(--border);
      background:rgba(255,255,255,.03);
      font-weight:900;font-size:12px;
    }
    .social:hover{filter:brightness(1.08)}
    .mutedRight{margin-inline-start:auto;font-weight:900;font-size:12px;color:rgba(185,193,217,.9)}
  </style>
</head>

<body>
  <div class="nav">
    <div class="container nav-inner">
      <div class="brand">
        <span class="dot"></span>
        <span id="brandText">Medo Gaming Store</span>
      </div>

      <div class="searchWrap">
        <input id="search" class="search" placeholder="ğŸ” Ø§Ø¨Ø­Ø«..." />
        <button class="iconBtn" id="filterBtn" title="Filter">
          <span style="display:inline-block;line-height:0">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" aria-hidden="true">
              <path d="M4 6h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M7 12h13" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M10 18h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M4 3h10" stroke="currentColor" stroke-width="2" stroke-linecap="round" opacity=".75"/>
            </svg>
          </span>
        </button>
      </div>

      <div class="rightBox">
        <button class="iconBtn" id="inboxBtn" title="Inbox">ğŸ”” <span class="pillCount" id="inboxCount">0</span></button>
        <button class="iconBtn" id="gemsBtn" title="Bonus">ğŸ’ <span class="pillCount" id="gemsCount">0</span></button>
        <button class="iconBtn" id="cartBtn" title="Cart">ğŸ›’ <span class="pillCount" id="cartCount">0</span></button>

        <button class="iconBtn" id="authBtn" title="Account">ğŸ‘¤ <span id="authText">ØªØ³Ø¬ÙŠÙ„</span></button>

        <div class="userChip" id="userChip" style="display:none" title="User">
          <span class="avatarSmall" id="avatarSmall">U</span>
          <span id="userNameText">User</span>
        </div>

        <button class="iconBtn" id="menuBtn" title="Menu">â˜°</button>
      </div>
    </div>
  </div>

  <div class="container">
    <div class="sectionTitle">ğŸ”¥ Top <span class="sectionHint">Ø§Ù„Ø£ÙƒØ«Ø± Ø·Ù„Ø¨Ù‹Ø§</span></div>
    <div id="gridTop" class="grid"></div>

    <div class="spacer"></div>

    <div class="sectionTitle">ğŸ Offers <span class="sectionHint">Ø¹Ø±ÙˆØ¶</span></div>
    <div id="gridOffers" class="grid"></div>

    <div class="spacer"></div>

    <div class="sectionTitle">ğŸ® Games</div>
    <div id="gridGames" class="grid"></div>

    <div class="spacer"></div>

    <div class="sectionTitle">ğŸ’» Programs</div>
    <div id="gridPrograms" class="grid"></div>

    <div class="spacer"></div>

    <div class="sectionTitle">ğŸ§¾ Accounts</div>
    <div id="gridAccounts" class="grid"></div>

    <div class="footer">
      <a class="social" href="https://wa.me/201006760663" target="_blank" rel="noreferrer">WhatsApp</a>
      <a class="social" href="https://www.instagram.com/medo__rami" target="_blank" rel="noreferrer">Instagram</a>
      <a class="social" href="https://www.facebook.com/share/1AScQqiSqq/" target="_blank" rel="noreferrer">Facebook</a>
      <a class="social" href="mailto:medorami77@gmail.com">Email</a>
      <span class="mutedRight">Â© <span id="year"></span> Medo Gaming</span>
    </div>
  </div>

  <div class="overlay" id="overlay"></div>

  <!-- MENU DRAWER -->
  <div class="drawer" id="menuDrawer" aria-hidden="true">
    <div class="drawerHeader">
      <div class="drawerTitle">Menu</div>
      <button class="iconBtn" id="menuClose">âœ•</button>
    </div>
    <div class="drawerBody">
      <div class="drawerSection" id="drawerUserBox" style="display:none">
        <div class="note ok" id="drawerUserNote"></div>
        <div class="row">
          <button class="btn" id="editProfileBtn">Edit profile</button>
          <button class="btn" id="logoutBtn">Logout</button>
        </div>
      </div>

      <div class="drawerSection">
        <p class="drawerLabel">Quick</p>
        <div class="drawerList">
          <div class="linkRow" data-scroll="gridTop"><span>Top</span><span class="mini">â†’</span></div>
          <div class="linkRow" data-scroll="gridOffers"><span>Offers</span><span class="mini">â†’</span></div>
          <div class="linkRow" data-scroll="gridGames"><span>Games</span><span class="mini">â†’</span></div>
          <div class="linkRow" data-scroll="gridPrograms"><span>Programs</span><span class="mini">â†’</span></div>
          <div class="linkRow" data-scroll="gridAccounts"><span>Accounts</span><span class="mini">â†’</span></div>
          <div class="linkRow" id="openContactRow"><span>Contact</span><span class="mini">â†’</span></div>
          <div class="linkRow" id="openReviewsRow"><span>Reviews</span><span class="mini">â†’</span></div>
          <div class="linkRow" id="openGiftRow"><span>Send Gift</span><span class="mini">â†’</span></div>
          <div class="linkRow" id="openInboxRow"><span>Inbox</span><span class="mini">â†’</span></div>
          <div class="linkRow" id="openBonusRow"><span>Bonus (Gems)</span><span class="mini">â†’</span></div>
        </div>
      </div>
    </div>
  </div>

  <!-- FILTER DRAWER -->
  <div class="drawer" id="filterDrawer" aria-hidden="true">
    <div class="drawerHeader">
      <div class="drawerTitle">Filter</div>
      <button class="iconBtn" id="filterClose">âœ•</button>
    </div>
    <div class="drawerBody">
      <div class="note">Ø§Ø®ØªØ§Ø± Ø§Ù„Ù‚Ø³Ù… ÙˆØ§Ù„ØªØ±ØªÙŠØ¨ ÙˆØ§Ù„Ø³Ø¹Ø± ÙˆØ¨Ø¹Ø¯ÙŠÙ† ØªØ·Ø¨ÙŠÙ‚.</div>

      <div class="drawerSection">
        <p class="drawerLabel">Category</p>
        <select class="select" id="filterCategory">
          <option value="all">All</option>
          <option value="games">Games</option>
          <option value="programs">Programs</option>
          <option value="accounts">Accounts</option>
        </select>
      </div>

      <div class="drawerSection">
        <p class="drawerLabel">Sort</p>
        <select class="select" id="filterSort">
          <option value="new">Newest</option>
          <option value="old">Oldest</option>
          <option value="low">Low â†’ High</option>
          <option value="high">High â†’ Low</option>
        </select>
      </div>

      <div class="drawerSection">
        <p class="drawerLabel">Price</p>
        <div class="row">
          <select class="select" id="priceMode">
            <option value="off">Off</option>
            <option value="eq">Equal</option>
            <option value="lte">â‰¤</option>
            <option value="gte">â‰¥</option>
          </select>
          <input class="input" id="priceValue" type="number" min="0" placeholder="Ù…Ø«Ù„Ø§Ù‹ 300" />
        </div>
      </div>

      <button class="btn btnRed" id="applyFilterBtn">Apply</button>
    </div>
  </div>

  <!-- CONTACT MODAL -->
  <div class="modal" id="contactModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Contact</div>
        <button class="iconBtn" id="contactClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <a class="btn" href="https://wa.me/201006760663" target="_blank">WhatsApp</a>
          <a class="btn" href="https://www.instagram.com/medo__rami" target="_blank">Instagram</a>
          <a class="btn" href="https://www.facebook.com/share/1AScQqiSqq/" target="_blank">Facebook</a>
          <a class="btn" href="mailto:medorami77@gmail.com">Email</a>
        </div>
      </div>
    </div>
  </div>

  <!-- REVIEWS MODAL -->
  <div class="modal" id="reviewsModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Reviews</div>
        <button class="iconBtn" id="reviewsClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="note">Ø§Ù„Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ø¨ØªØªØ®Ø²Ù† Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø² (Demo).</div>
          <div class="row">
            <input class="input" id="reviewText" placeholder="Ø§ÙƒØªØ¨ Ø±Ø£ÙŠÙƒ..." />
            <button class="btn btnRed tight" id="addReviewBtn" style="flex:0 0 auto">Post</button>
          </div>
          <div class="stack" id="reviewsList"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- GIFT MODAL -->
  <div class="modal" id="giftModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Send Gift</div>
        <button class="iconBtn" id="giftClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="note">Ø§ÙƒØªØ¨ Ø¨Ø±ÙŠØ¯ Ø§Ù„Ù…Ø³ØªÙ„Ù…. Ù„Ùˆ Ù…Ø´ Ù…Ø³Ø¬Ù„ Ù‡ÙŠØ±ÙØ¶ (Demo).</div>
          <input class="input" id="giftToEmail" type="email" placeholder="Receiver email" />
          <div class="row">
            <select class="select" id="giftType">
              <option value="gems">Gems</option>
              <option value="product">Product ID</option>
            </select>
            <input class="input" id="giftAmount" type="text" placeholder="Amount / Product ID" />
          </div>
          <button class="btn btnRed" id="sendGiftBtn">Send</button>
          <div class="note err" id="giftErr" style="display:none"></div>
          <div class="note ok" id="giftOk" style="display:none"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- INBOX MODAL -->
  <div class="modal" id="inboxModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Inbox</div>
        <button class="iconBtn" id="inboxClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="note">Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø¨ØªØªØ®Ø²Ù† Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Demo).</div>
          <div id="inboxList" class="stack"></div>
          <button class="btn" id="clearInboxBtn">Clear</button>
        </div>
      </div>
    </div>
  </div>

  <!-- BONUS MODAL -->
  <div class="modal" id="bonusModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Bonus (Gems)</div>
        <button class="iconBtn" id="bonusClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="note">ÙƒÙ„ 100 Ø¬Ù†ÙŠÙ‡ Ø´Ø±Ø§Ø¡ = 1 Gem (Demo). ØªÙ‚Ø¯Ø± ØªØ¨Ø¯Ù‘Ù„ Ø§Ù„Ø¬ÙˆØ§Ù‡Ø± Ø¨ÙƒØ§Ø±Øª Ø®ØµÙ….</div>
          <div class="note ok" id="bonusState"></div>

          <div class="drawerSection">
            <p class="drawerLabel">Redeem</p>
            <div class="row">
              <select class="select" id="redeemChoice">
                <option value="10">10% (10 Gems)</option>
                <option value="20">20% (20 Gems)</option>
                <option value="30">30% (30 Gems)</option>
                <option value="40">40% (40 Gems)</option>
              </select>
              <button class="btn btnRed tight" id="redeemBtn" style="flex:0 0 auto">Redeem</button>
            </div>
            <div class="note warn" id="redeemMsg" style="display:none"></div>
            <div class="note ok" id="redeemOk" style="display:none"></div>
          </div>

          <div class="drawerSection">
            <p class="drawerLabel">Your Discount Card</p>
            <div class="note" id="discountCardBox">No active discount card.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- CART MODAL -->
  <div class="modal" id="cartModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Cart</div>
        <button class="iconBtn" id="cartClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div id="cartItems"></div>
          <div class="totalBar" id="totalBar">
            <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</span>
            <strong id="cartTotal">EGP 0</strong>
          </div>

          <div class="drawerSection">
            <p class="drawerLabel">Coupon</p>
            <div class="row">
              <input class="input" id="couponInput" placeholder="Ø§ÙƒØªØ¨ ÙƒÙˆØ¯ Ø§Ù„Ø®ØµÙ… (MG1..MI10)" />
              <button class="btn tight" id="applyCouponBtn" style="flex:0 0 auto">Apply</button>
            </div>
            <div class="note warn" id="couponMsg" style="display:none"></div>
            <div class="note ok" id="couponOk" style="display:none"></div>
          </div>

          <button class="btn btnRed" id="checkoutBtn">Buy (Checkout)</button>
          <div class="note" id="checkoutNote" style="display:none"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- DETAILS MODAL -->
  <div class="modal" id="detailsModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle" id="detailsTitle">Details</div>
        <button class="iconBtn" id="detailsClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="galleryBig" id="galleryBig">IMG</div>
          <div class="galleryRow" id="galleryRow"></div>

          <div class="note" id="detailsDesc"></div>
          <div class="row">
            <div class="note ok" id="detailsPrice"></div>
            <button class="btn btnBlue tight" id="detailsAddCart" style="flex:0 0 auto">ğŸ›’ Add</button>
            <button class="btn btnRed tight" id="detailsBuy" style="flex:0 0 auto">âš¡ Buy</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- AUTH MODAL -->
  <div class="modal" id="authModal">
    <div class="modalBox">
      <div class="modalHeader">
        <div class="modalTitle">Account</div>
        <button class="iconBtn" id="authClose">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="stack">
          <div class="row">
            <button class="btn" id="tabLogin">Login</button>
            <button class="btn" id="tabRegister">Create Account</button>
          </div>

          <div id="loginBox" class="stack">
            <input class="input" id="loginEmail" type="email" placeholder="Email" />
            <input class="input" id="loginPass" type="password" placeholder="Password" />
            <button class="btn btnRed" id="loginBtn">Login</button>
            <div class="note err" id="loginErr" style="display:none"></div>
          </div>

          <div id="registerBox" class="stack" style="display:none">
            <input class="input" id="regName" placeholder="Ø§Ø³Ù…Ùƒ ÙÙŠ Ø§Ù„Ù…ÙˆÙ‚Ø¹" />
            <input class="input" id="regEmail" type="email" placeholder="Email" />
            <input class="input" id="regPass" type="password" placeholder="Password" />
            <button class="btn btnRed" id="registerBtn">Create</button>
            <div class="note err" id="regErr" style="display:none"></div>
            <div class="note ok" id="regOk" style="display:none"></div>
          </div>

          <div class="note warn">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø¯Ù‡ Demo Ø¹Ù„Ù‰ GitHub Pages â€” Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª Ø¨ØªØªØ®Ø²Ù† Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    /* ===== Helpers ===== */
    const $ = (id)=>document.getElementById(id);
    const money = (x)=> `EGP ${Math.max(0, Math.round(x))}`;
    const now = ()=> new Date().toISOString();
    function safeJsonParse(s, fallback){
      try{ return JSON.parse(s); }catch{ return fallback; }
    }

    /* ===== Storage Keys ===== */
    const LS_USERS = "mgs_users_v1";           // { email: {name, pass, avatarDataUrl?, gems, discount?, inbox:[] } }
    const LS_SESSION = "mgs_session_v1";       // { email }
    const LS_CART = "mgs_cart_v1";             // { items: { [productId]: qty }, coupon?:string, usedCoupons: {code:true} }
    const LS_REVIEWS="mgs_reviews_demo";

    /* ===== Data (Products Demo) ===== */
    const products = [
      { id: 101, type:"games", name:"Action Game Pack", desc:"Ù„Ø¹Ø¨Ø© Ø£ÙƒØ´Ù† - ØªÙ‚Ø¯Ø± ØªØºÙŠØ± Ø§Ù„ÙˆØµÙ Ø¨Ø±Ø§Ø­ØªÙƒ.", price:250, top:true, images:["G1","G1-2","G1-3"] },
      { id: 102, type:"games", name:"Racing Game", desc:"Ø³Ø¨Ø§Ù‚Ø§Øª - Ù†Ø³Ø®Ø© Ù†Ø¸ÙŠÙØ©.", price:180, offer:true, images:["G2","G2-2","G2-3"] },
      { id: 103, type:"games", name:"Adventure Game", desc:"Ù…ØºØ§Ù…Ø±Ø© - Ù…Ø­ØªÙˆÙ‰ Ø·ÙˆÙŠÙ„.", price:300, images:["G3","G3-2","G3-3"] },
      { id: 104, type:"games", name:"Online Game", desc:"Ø£ÙˆÙ†Ù„Ø§ÙŠÙ† - Ù…Ù†Ø§Ø³Ø¨ Ù„Ù„Ø¬ÙŠÙ…Ø±Ø².", price:120, offer:true, images:["G4","G4-2","G4-3"] },

      { id: 201, type:"programs", name:"Video Editor Pro", desc:"Ø¨Ø±Ù†Ø§Ù…Ø¬ Ù…ÙˆÙ†ØªØ§Ø¬ (Demo).", price:150, top:true, images:["P1","P1-2","P1-3"] },
      { id: 202, type:"programs", name:"Design Suite", desc:"ØªØµÙ…ÙŠÙ… ÙˆØ¬Ø±Ø§ÙÙŠÙƒ.", price:90, images:["P2","P2-2","P2-3"] },
      { id: 203, type:"programs", name:"Utility Tools", desc:"Ø£Ø¯ÙˆØ§Øª Ù…Ø³Ø§Ø¹Ø¯Ø©.", price:220, offer:true, images:["P3","P3-2","P3-3"] },
      { id: 204, type:"programs", name:"Streaming Helper", desc:"Ù…ÙÙŠØ¯ Ù„Ù„Ø¨Ø«.", price:60, images:["P4","P4-2","P4-3"] },

      { id: 301, type:"accounts", name:"PUBG Account", desc:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆÙ†Øª Ù‡Ù†Ø§â€¦ (Ø³ÙƒÙŠÙ†Ø§Øª/Ø£Ø³Ù„Ø­Ø©/Ù…Ù„Ø§Ø¨Ø³).", price:700, top:true, images:["A1","A1-2","A1-3","A1-4"] },
      { id: 302, type:"accounts", name:"Steam Account", desc:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆÙ†Øª Ù‡Ù†Ø§â€¦", price:350, offer:true, images:["A2","A2-2","A2-3"] },
      { id: 303, type:"accounts", name:"Epic Account", desc:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆÙ†Øª Ù‡Ù†Ø§â€¦", price:200, images:["A3","A3-2","A3-3"] },
      { id: 304, type:"accounts", name:"FreeFire Account", desc:"ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø£ÙƒÙˆÙ†Øª Ù‡Ù†Ø§â€¦", price:450, images:["A4","A4-2","A4-3"] },
    ];
    const productById = (id)=> products.find(p=>p.id===id);

    /* ===== Coupons (MG..MI) ===== */
    // MG 10% (MG1..MG10), MZ 20%, MK 30%, MC 40%, MA 50%, MB 60%, ME 70%, MX 80%, MR 90%, MI 100%
    const couponMapPrefix = {
      MG:10, MZ:20, MK:30, MC:40, MA:50, MB:60, ME:70, MX:80, MR:90, MI:100
    };
    function parseCoupon(code){
      if(!code) return null;
      const c = code.trim().toUpperCase();
      const m = c.match(/^([A-Z]{2})(10|[1-9])$/);
      if(!m) return null;
      const pref = m[1];
      const pct = couponMapPrefix[pref];
      if(!pct) return null;
      return { code:c, percent:pct };
    }

    /* ===== Users / Session ===== */
    function loadUsers(){ return safeJsonParse(localStorage.getItem(LS_USERS)||"{}", {}); }
    function saveUsers(u){ localStorage.setItem(LS_USERS, JSON.stringify(u)); }
    function getSession(){ return safeJsonParse(localStorage.getItem(LS_SESSION)||"null", null); }
    function setSession(s){ localStorage.setItem(LS_SESSION, JSON.stringify(s)); }
    function clearSession(){ localStorage.removeItem(LS_SESSION); }

    function getCurrentUser(){
      const sess = getSession();
      if(!sess || !sess.email) return null;
      const users = loadUsers();
      return users[sess.email] ? { email:sess.email, ...users[sess.email] } : null;
    }
    function updateUser(email, patch){
      const users = loadUsers();
      if(!users[email]) return;
      users[email] = { ...users[email], ...patch };
      saveUsers(users);
    }

    /* ===== Inbox / Notifications ===== */
    function pushInbox(msg){
      const u = getCurrentUser();
      if(!u) return;
      const users = loadUsers();
      users[u.email].inbox = users[u.email].inbox || [];
      users[u.email].inbox.unshift({ at: now(), text: msg });
      saveUsers(users);
      refreshCounts();
    }
    function loadInbox(){
      const u = getCurrentUser();
      if(!u) return [];
      const users = loadUsers();
      return (users[u.email].inbox || []);
    }
    function clearInbox(){
      const u = getCurrentUser();
      if(!u) return;
      const users = loadUsers();
      users[u.email].inbox = [];
      saveUsers(users);
      refreshCounts();
    }

    /* ===== Gems / Bonus ===== */
    function addGemsFromSpend(amount){
      const u = getCurrentUser();
      if(!u) return;
      const add = Math.floor(Math.max(0, amount) / 100); // 1 gem Ù„ÙƒÙ„ 100
      if(add <= 0) return;
      const users = loadUsers();
      users[u.email].gems = (users[u.email].gems || 0) + add;
      saveUsers(users);
      pushInbox(`ğŸ’ Ø­ØµÙ„Øª Ø¹Ù„Ù‰ ${add} Gems Ø¨Ø³Ø¨Ø¨ Ø´Ø±Ø§Ø¡ Ø¨Ù‚ÙŠÙ…Ø© ${money(amount)}.`);
    }

    /* Discount card stored on user: {percent, code, expiresAt?} */
    function setDiscountCard(percent){
      const u = getCurrentUser();
      if(!u) return;
      const code = `GEMS-${percent}-${Math.random().toString(36).slice(2,7).toUpperCase()}`;
      updateUser(u.email, { discount: { percent, code, at: now() } });
      pushInbox(`ğŸŸï¸ Ø§ØªØ¹Ù…Ù„ØªÙ„Ùƒ ÙƒØ§Ø±Øª Ø®ØµÙ… ${percent}% (Code: ${code}).`);
    }
    function getDiscountCard(){
      const u = getCurrentUser();
      if(!u) return null;
      return u.discount || null;
    }

    /* ===== Cart ===== */
    function loadCart(){
      const base = safeJsonParse(localStorage.getItem(LS_CART)||"null", null);
      return base || { items:{}, coupon:null, usedCoupons:{} };
    }
    function saveCart(c){ localStorage.setItem(LS_CART, JSON.stringify(c)); }
    function cartCount(){
      const c = loadCart();
      return Object.values(c.items||{}).reduce((a,b)=>a+b,0);
    }
    function cartLines(){
      const c = loadCart();
      const items = c.items || {};
      return Object.keys(items).map(pid=>{
        const p = productById(Number(pid));
        return p ? { product:p, qty:items[pid] } : null;
      }).filter(Boolean);
    }
    function cartSubtotal(){
      return cartLines().reduce((sum, line)=> sum + (line.product.price * line.qty), 0);
    }
    function cartDiscountAmount(){
      const c = loadCart();
      const subtotal = cartSubtotal();
      let pct = 0;

      // coupon (single-use global on device)
      if(c.coupon){
        const parsed = parseCoupon(c.coupon);
        if(parsed) pct = Math.max(pct, parsed.percent);
      }

      // discount card from gems (per user)
      const card = getDiscountCard();
      if(card && card.percent) pct = Math.max(pct, card.percent);

      const disc = subtotal * (pct/100);
      return { percent:pct, amount:disc };
    }
    function cartTotal(){
      const sub = cartSubtotal();
      const disc = cartDiscountAmount();
      return Math.max(0, sub - disc.amount);
    }

    function addToCart(productId, qty=1){
      const c = loadCart();
      c.items = c.items || {};
      c.items[productId] = (c.items[productId] || 0) + qty;
      saveCart(c);
      refreshCounts();
      pushInbox(`ğŸ›’ Ø§ØªØ¶Ø§Ù Ù„Ù„Ø³Ù„Ø©: #${productId} (+${qty}).`);
    }
    function setQty(productId, qty){
      const c = loadCart();
      c.items = c.items || {};
      if(qty <= 0) delete c.items[productId];
      else c.items[productId] = qty;
      saveCart(c);
      refreshCounts();
    }
    function clearCart(){
      const c = loadCart();
      c.items = {};
      c.coupon = null;
      saveCart(c);
      refreshCounts();
    }

    /* ===== UI / Drawers / Modals ===== */
    const overlay = $("overlay");
    const menuDrawer = $("menuDrawer");
    const filterDrawer = $("filterDrawer");

    function openOverlay(){ overlay.classList.add("show"); }
    function closeOverlay(){ overlay.classList.remove("show"); }

    function hideAllPopups(){
      menuDrawer.classList.remove("show");
      filterDrawer.classList.remove("show");
      ["contactModal","reviewsModal","giftModal","inboxModal","bonusModal","cartModal","detailsModal","authModal"].forEach(id=>{
        $(id).classList.remove("show");
      });
      menuDrawer.setAttribute("aria-hidden","true");
      filterDrawer.setAttribute("aria-hidden","true");
    }

    function closeAll(){
      closeOverlay();
      hideAllPopups();
      // reset small messages
      $("giftErr").style.display="none";
      $("giftOk").style.display="none";
      $("couponMsg").style.display="none";
      $("couponOk").style.display="none";
      $("checkoutNote").style.display="none";
      $("redeemMsg").style.display="none";
      $("redeemOk").style.display="none";
      $("loginErr").style.display="none";
      $("regErr").style.display="none";
      $("regOk").style.display="none";
    }

    function openDrawer(drawer){
      openOverlay();
      drawer.classList.add("show");
      drawer.setAttribute("aria-hidden","false");
    }
    function openModal(modalId){
      openOverlay();
      $(modalId).classList.add("show");
    }

    overlay.addEventListener("click", closeAll);

    /* ===== Rendering products ===== */
    function cardHTML(p){
      const badge = p.top ? `<span class="badge top">ğŸ”¥ Top</span>` : (p.offer ? `<span class="badge offer">ğŸ Offer</span>` : "");
      return `
        <div class="card">
          <div class="thumb">
            ${badge}
            ${p.type.toUpperCase()}
          </div>
          <div class="content">
            <p class="name">${p.name}</p>
            <p class="meta">${p.desc || ""}</p>
            <div class="priceRow">
              <p class="price">${money(p.price)}</p>
              <span class="sectionHint">#${p.id}</span>
            </div>
            <div class="actions">
              <button class="btn btnBlue" data-act="details" data-id="${p.id}">â„¹ï¸ Details</button>
              <button class="btn" data-act="add" data-id="${p.id}">ğŸ›’ Add</button>
              <button class="btn btnRed" data-act="buy" data-id="${p.id}">âš¡ Buy</button>
            </div>
          </div>
        </div>
      `;
    }

    function applyFilters(list){
      const q = ($("search").value||"").toLowerCase().trim();
      const cat = $("filterCategory").value;
      const sort = $("filterSort").value;
      const pm = $("priceMode").value;
      const pv = Number($("priceValue").value);

      let out = [...list];
      if(q) out = out.filter(p => (p.name + " " + (p.desc||"")).toLowerCase().includes(q));
      if(cat !== "all") out = out.filter(p => p.type === cat);

      if(pm !== "off" && !Number.isNaN(pv) && String($("priceValue").value).trim()!==""){
        if(pm === "eq") out = out.filter(p=>p.price === pv);
        if(pm === "lte") out = out.filter(p=>p.price <= pv);
        if(pm === "gte") out = out.filter(p=>p.price >= pv);
      }

      if(sort === "new") out.sort((a,b)=> b.id - a.id);
      if(sort === "old") out.sort((a,b)=> a.id - b.id);
      if(sort === "low") out.sort((a,b)=> a.price - b.price);
      if(sort === "high") out.sort((a,b)=> b.price - a.price);

      return out;
    }

    function renderAll(){
      const filtered = applyFilters(products);

      const tops = filtered.filter(p=>p.top);
      const offers = filtered.filter(p=>p.offer);

      $("gridTop").innerHTML = tops.length ? tops.map(cardHTML).join("") : `<div class="note">Ù…ÙÙŠØ´ Top Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
      $("gridOffers").innerHTML = offers.length ? offers.map(cardHTML).join("") : `<div class="note">Ù…ÙÙŠØ´ Offers Ø­Ø§Ù„ÙŠØ§Ù‹.</div>`;
      $("gridGames").innerHTML = filtered.filter(p=>p.type==="games").map(cardHTML).join("") || `<div class="note">Ù…ÙÙŠØ´ Games.</div>`;
      $("gridPrograms").innerHTML = filtered.filter(p=>p.type==="programs").map(cardHTML).join("") || `<div class="note">Ù…ÙÙŠØ´ Programs.</div>`;
      $("gridAccounts").innerHTML = filtered.filter(p=>p.type==="accounts").map(cardHTML).join("") || `<div class="note">Ù…ÙÙŠØ´ Accounts.</div>`;

      // bind actions
      document.querySelectorAll("[data-act]").forEach(btn=>{
        btn.onclick = ()=>{
          const id = Number(btn.dataset.id);
          const act = btn.dataset.act;
          if(act==="details") openDetails(id);
          if(act==="add"){
            if(!getCurrentUser()){
              openAuth();
              $("loginErr").style.display="block";
              $("loginErr").textContent = "Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† Ø§Ù„Ø³Ù„Ø© ÙˆØ§Ù„Ø¨ÙˆÙ†Øµ.";
              return;
            }
            addToCart(id,1);
          }
          if(act==="buy"){
            if(!getCurrentUser()){
              openAuth();
              $("loginErr").style.display="block";
              $("loginErr").textContent = "Ù„Ø§Ø²Ù… ØªØ¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„ Ø¹Ø´Ø§Ù† Ø§Ù„Ø´Ø±Ø§Ø¡.";
              return;
            }
            // buy single item flow: add, then open cart
            addToCart(id,1);
            openCart();
          }
        };
      });
    }

    /* ===== Details ===== */
    let currentDetailsId = null;
    let currentGalleryIndex = 0;

    function openDetails(id){
      const p = productById(id);
      if(!p) return;

      currentDetailsId = id;
      currentGalleryIndex = 0;

      $("detailsTitle").textContent = `${p.name} (#${p.id})`;
      $("detailsDesc").textContent = p.desc || "";
      $("detailsPrice").textContent = `Ø§Ù„Ø³Ø¹Ø±: ${money(p.price)}`;

      renderGallery(p);

      openModal("detailsModal");
    }

    function renderGallery(p){
      const imgs = p.images || ["IMG"];
      const active = imgs[currentGalleryIndex] || imgs[0];
      $("galleryBig").textContent = active;

      $("galleryRow").innerHTML = imgs.map((t,idx)=>{
        return `<div class="gThumb ${idx===currentGalleryIndex?"active":""}" data-g="${idx}">${t}</div>`;
      }).join("");

      document.querySelectorAll("[data-g]").forEach(el=>{
        el.onclick = ()=>{
          currentGalleryIndex = Number(el.dataset.g);
          renderGallery(p);
        };
      });
    }

    $("detailsClose").onclick = closeAll;
    $("detailsAddCart").onclick = ()=>{
      if(!currentDetailsId) return;
      if(!getCurrentUser()){ openAuth(); return; }
      addToCart(currentDetailsId,1);
    };
    $("detailsBuy").onclick = ()=>{
      if(!currentDetailsId) return;
      if(!getCurrentUser()){ openAuth(); return; }
      addToCart(currentDetailsId,1);
      closeAll();
      openCart();
    };

    /* ===== Reviews ===== */
    function loadReviews(){ return safeJsonParse(localStorage.getItem(LS_REVIEWS)||"[]", []); }
    function saveReviews(r){ localStorage.setItem(LS_REVIEWS, JSON.stringify(r)); }
    function escapeHtml(s){ return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

    function renderReviews(){
      const list = $("reviewsList");
      const reviews = loadReviews();
      if(!reviews.length){
        list.innerHTML = `<div class="note">Ù…ÙÙŠØ´ Ù…Ø±Ø§Ø¬Ø¹Ø§Øª Ù„Ø³Ù‡.</div>`;
        return;
      }
      list.innerHTML = reviews.map(r=>{
        const time = new Date(r.at).toLocaleString();
        return `<div class="note"><strong>${escapeHtml(r.by)}</strong> â€” ${time}<br>${escapeHtml(r.text)}</div>`;
      }).join("");
    }

    $("addReviewBtn").onclick = ()=>{
      const text = ($("reviewText").value||"").trim();
      if(!text) return;
      const u = getCurrentUser();
      const by = u ? u.name : "Ø²Ø§Ø¦Ø±";
      const reviews = loadReviews();
      reviews.unshift({ at: now(), by, text });
      saveReviews(reviews);
      $("reviewText").value="";
      renderReviews();
      pushInbox("ğŸ“ Ø§ØªØ³Ø¬Ù„Øª Ù…Ø±Ø§Ø¬Ø¹Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆÙ‚Ø¹.");
    };

    /* ===== Auth ===== */
    function openAuth(){
      openModal("authModal");
      // default tab login
      showAuthTab("login");
    }
    function showAuthTab(tab){
      $("loginBox").style.display = tab==="login" ? "flex" : "none";
      $("registerBox").style.display = tab==="register" ? "flex" : "none";
      $("loginErr").style.display="none";
      $("regErr").style.display="none";
      $("regOk").style.display="none";
    }
    $("authClose").onclick = closeAll;
    $("tabLogin").onclick = ()=> showAuthTab("login");
    $("tabRegister").onclick = ()=> showAuthTab("register");

    $("registerBtn").onclick = ()=>{
      const name = ($("regName").value||"").trim();
      const email = ($("regEmail").value||"").trim().toLowerCase();
      const pass = ($("regPass").value||"").trim();

      $("regErr").style.display="none";
      $("regOk").style.display="none";

      if(!name || !email || !pass){
        $("regErr").style.display="block";
        $("regErr").textContent="Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙƒÙ„Ù‡Ø§.";
        return;
      }

      const users = loadUsers();
      if(users[email]){
        $("regErr").style.display="block";
        $("regErr").textContent="Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ø¯Ù‡ Ù…ØªØ³Ø¬Ù„ Ù‚Ø¨Ù„ ÙƒØ¯Ù‡. Ø§Ø¯Ø®Ù„ Login.";
        return;
      }

      users[email] = { name, pass, gems:0, inbox:[], discount:null, avatar:null };
      saveUsers(users);

      $("regOk").style.display="block";
      $("regOk").textContent="Ø§ØªØ¹Ù…Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ âœ… Ø¯Ù„ÙˆÙ‚ØªÙŠ Ø§Ø¹Ù…Ù„ Login.";
      pushInbox("âœ… Ø§ØªØ¹Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯.");
    };

    $("loginBtn").onclick = ()=>{
      const email = ($("loginEmail").value||"").trim().toLowerCase();
      const pass = ($("loginPass").value||"").trim();
      $("loginErr").style.display="none";

      const users = loadUsers();
      if(!users[email]){
        $("loginErr").style.display="block";
        $("loginErr").textContent="Ø§Ù„Ø­Ø³Ø§Ø¨ Ø¯Ù‡ Ù…Ø´ Ù…ÙˆØ¬ÙˆØ¯. Ø§Ø¹Ù…Ù„ Create Account.";
        return;
      }
      if(users[email].pass !== pass){
        $("loginErr").style.display="block";
        $("loginErr").textContent="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙ„Ø·.";
        return;
      }

      setSession({ email });
      pushInbox("ğŸ‘‹ ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­.");
      closeAll();
      refreshHeaderUser();
      refreshCounts();
    };

    function logout(){
      clearSession();
      closeAll();
      refreshHeaderUser();
      refreshCounts();
    }
    $("logoutBtn").onclick = logout;

    $("editProfileBtn").onclick = ()=>{
      const u = getCurrentUser();
      if(!u) return;
      const newName = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø¬Ø¯ÙŠØ¯:", u.name || "");
      if(newName && newName.trim()){
        updateUser(u.email, { name:newName.trim() });
        pushInbox("âœï¸ ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ø³Ù… Ø§Ù„Ø­Ø³Ø§Ø¨.");
        refreshHeaderUser();
      }
    };

    /* ===== Header user state ===== */
    function refreshHeaderUser(){
      const u = getCurrentUser();
      if(!u){
        $("authBtn").style.display="inline-flex";
        $("userChip").style.display="none";
        $("drawerUserBox").style.display="none";
        return;
      }

      $("authBtn").style.display="none";
      $("userChip").style.display="inline-flex";
      $("userNameText").textContent = u.name || u.email;

      const letter = (u.name || u.email || "U").trim().charAt(0).toUpperCase();
      $("avatarSmall").textContent = letter;

      $("drawerUserBox").style.display="block";
      $("drawerUserNote").textContent = `Logged in as: ${u.name || u.email}`;
    }

    /* ===== Cart UI ===== */
    function openCart(){
      renderCart();
      openModal("cartModal");
    }
    $("cartClose").onclick = closeAll;

    function renderCart(){
      const lines = cartLines();
      const box = $("cartItems");

      if(!lines.length){
        box.innerHTML = `<div class="note">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø¶ÙŠØ©.</div>`;
        $("cartTotal").textContent = money(0);
        return;
      }

      box.innerHTML = lines.map(line=>{
        const p = line.product;
        const qty = line.qty;
        return `
          <div class="cartItem">
            <div class="cartLeft">
              <div class="cartThumb">${(p.images && p.images[0]) ? p.images[0] : "IMG"}</div>
              <div style="flex:1">
                <div class="cartName">${p.name}</div>
                <div class="cartMeta">#${p.id} â€¢ ${money(p.price)} â€¢ ${p.type}</div>
                <div class="qtyRow">
                  <button class="qtyBtn" data-q="plus" data-id="${p.id}">+</button>
                  <div class="qtyNum">${qty}</div>
                  <button class="qtyBtn" data-q="minus" data-id="${p.id}">-</button>
                  <button class="detailsBtn" data-det="${p.id}">Details</button>
                  <button class="removeBtn" data-rem="${p.id}">Remove</button>
                </div>
              </div>
            </div>
            <strong>${money(p.price * qty)}</strong>
          </div>
        `;
      }).join("");

      const disc = cartDiscountAmount();
      const sub = cartSubtotal();
      const total = cartTotal();

      $("cartTotal").textContent = money(total);

      // bind
      document.querySelectorAll("[data-q]").forEach(b=>{
        b.onclick = ()=>{
          const id = Number(b.dataset.id);
          const c = loadCart();
          const cur = c.items[id] || 0;
          if(b.dataset.q==="plus") setQty(id, cur+1);
          if(b.dataset.q==="minus") setQty(id, cur-1);
          renderCart();
        };
      });
      document.querySelectorAll("[data-rem]").forEach(b=>{
        b.onclick = ()=>{
          const id = Number(b.dataset.rem);
          setQty(id,0);
          renderCart();
        };
      });
      document.querySelectorAll("[data-det]").forEach(b=>{
        b.onclick = ()=>{
          const id = Number(b.dataset.det);
          closeAll();
          openDetails(id);
        };
      });

      // show subtotal/discount info in checkoutNote when open
      $("checkoutNote").style.display="none";

      // Coupon fields reset messages
      $("couponMsg").style.display="none";
      $("couponOk").style.display="none";
    }

    $("cartBtn").onclick = ()=>{
      if(!getCurrentUser()){ openAuth(); return; }
      openCart();
    };

    $("applyCouponBtn").onclick = ()=>{
      const code = ($("couponInput").value||"").trim().toUpperCase();
      $("couponMsg").style.display="none";
      $("couponOk").style.display="none";

      const parsed = parseCoupon(code);
      if(!parsed){
        $("couponMsg").style.display="block";
        $("couponMsg").textContent = "Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± ØµØ­ÙŠØ­.";
        return;
      }

      const c = loadCart();
      c.usedCoupons = c.usedCoupons || {};
      if(c.usedCoupons[parsed.code]){
        $("couponMsg").style.display="block";
        $("couponMsg").textContent = "Ø§Ù„ÙƒÙˆØ¯ Ø¯Ù‡ Ø§ØªØ³ØªØ®Ø¯Ù… Ù‚Ø¨Ù„ ÙƒØ¯Ù‡ Ø¹Ù„Ù‰ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø².";
        return;
      }

      c.coupon = parsed.code;
      saveCart(c);

      $("couponOk").style.display="block";
      $("couponOk").textContent = `âœ… ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø®ØµÙ… ${parsed.percent}% (ÙƒÙˆØ¯: ${parsed.code}).`;
      pushInbox(`ğŸ·ï¸ ØªÙ… ØªØ·Ø¨ÙŠÙ‚ ÙƒÙˆØ¨ÙˆÙ† ${parsed.code} (${parsed.percent}%).`);
      renderCart();
      refreshCounts();
    };

    $("checkoutBtn").onclick = ()=>{
      const u = getCurrentUser();
      if(!u){ openAuth(); return; }

      const c = loadCart();
      const lines = cartLines();
      if(!lines.length) return;

      const sub = cartSubtotal();
      const disc = cartDiscountAmount();
      const total = cartTotal();

      // mark coupon as used (single-use on device)
      if(c.coupon){
        const parsed = parseCoupon(c.coupon);
        if(parsed){
          c.usedCoupons = c.usedCoupons || {};
          c.usedCoupons[parsed.code] = true;
          c.coupon = null; // clear after consume
          saveCart(c);
        }
      }

      // if user has discount card (from gems), we consume it once
      const card = getDiscountCard();
      if(card){
        updateUser(u.email, { discount: null });
      }

      // grant gems based on "total paid" or subtotal? choose paid amount for balance:
      addGemsFromSpend(total);

      pushInbox(`âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø´Ø±Ø§Ø¡ (Demo): Subtotal ${money(sub)} - Discount ${disc.percent}% = Total ${money(total)}.`);

      $("checkoutNote").style.display="block";
      $("checkoutNote").className = "note ok";
      $("checkoutNote").textContent = "ØªÙ… Ø§Ù„Ø´Ø±Ø§Ø¡ (Demo) âœ… â€” Ø§ØªØ¶Ø§ÙØª Ø±Ø³Ø§Ø¦Ù„ ÙˆØ¨ÙˆÙ†Øµ Ø­Ø³Ø¨ Ø§Ù„Ù‚ÙŠÙ…Ø©.";

      // clear cart after purchase
      clearCart();
      renderCart();
    };

    /* ===== Inbox UI ===== */
    function openInbox(){
      renderInbox();
      openModal("inboxModal");
    }
    function renderInbox(){
      const list = $("inboxList");
      const u = getCurrentUser();
      if(!u){
        list.innerHTML = `<div class="note err">Ø§Ø¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„.</div>`;
        return;
      }
      const msgs = loadInbox();
      if(!msgs.length){
        list.innerHTML = `<div class="note">Ù…ÙÙŠØ´ Ø±Ø³Ø§Ø¦Ù„ Ù„Ø³Ù‡.</div>`;
        return;
      }
      list.innerHTML = msgs.map(m=>{
        const t = new Date(m.at).toLocaleString();
        return `<div class="note"><strong>${t}</strong><br>${escapeHtml(m.text)}</div>`;
      }).join("");
    }
    $("inboxBtn").onclick = ()=>{
      if(!getCurrentUser()){ openAuth(); return; }
      openInbox();
    };
    $("inboxClose").onclick = closeAll;
    $("clearInboxBtn").onclick = ()=>{
      clearInbox();
      renderInbox();
    };

    /* ===== Bonus UI ===== */
    function openBonus(){
      renderBonus();
      openModal("bonusModal");
    }
    function renderBonus(){
      const u = getCurrentUser();
      if(!u){
        $("bonusState").className="note err";
        $("bonusState").textContent="Ø§Ø¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„.";
        $("discountCardBox").textContent="No active discount card.";
        return;
      }
      $("bonusState").className="note ok";
      $("bonusState").textContent=`ğŸ’ Gems: ${u.gems || 0}`;
      const card = u.discount;
      $("discountCardBox").textContent = card ? `Active: ${card.percent}% (Code: ${card.code})` : "No active discount card.";
    }
    $("gemsBtn").onclick = ()=>{
      if(!getCurrentUser()){ openAuth(); return; }
      openBonus();
    };
    $("bonusClose").onclick = closeAll;

    $("redeemBtn").onclick = ()=>{
      $("redeemMsg").style.display="none";
      $("redeemOk").style.display="none";
      const u = getCurrentUser();
      if(!u){
        $("redeemMsg").style.display="block";
        $("redeemMsg").textContent="Ø§Ø¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„.";
        return;
      }
      const pct = Number($("redeemChoice").value);
      const need = pct; // 10% needs 10 gems ... 40% needs 40 gems
      if((u.gems || 0) < need){
        $("redeemMsg").style.display="block";
        $("redeemMsg").textContent=`Ù…Ø¹Ø§Ùƒ ${u.gems||0} Gems Ø¨Ø³. Ù…Ø­ØªØ§Ø¬ ${need}.`;
        return;
      }

      // spend gems
      updateUser(u.email, { gems: (u.gems||0) - need });
      setDiscountCard(pct);

      $("redeemOk").style.display="block";
      $("redeemOk").textContent=`âœ… Ø§ØªØ¹Ù…Ù„ ÙƒØ§Ø±Øª Ø®ØµÙ… ${pct}% ÙˆØ§ØªØ®ØµÙ…Øª ${need} Gems.`;

      refreshCounts();
      renderBonus();
    };

    /* ===== Gift ===== */
    $("sendGiftBtn").onclick = ()=>{
      $("giftErr").style.display="none";
      $("giftOk").style.display="none";

      const u = getCurrentUser();
      if(!u){
        $("giftErr").style.display="block";
        $("giftErr").textContent="Ø§Ø¹Ù…Ù„ Login Ø§Ù„Ø£ÙˆÙ„.";
        return;
      }

      const toEmail = ($("giftToEmail").value||"").trim().toLowerCase();
      const type = $("giftType").value;
      const amount = ($("giftAmount").value||"").trim();

      const users = loadUsers();
      if(!users[toEmail]){
        $("giftErr").style.display="block";
        $("giftErr").textContent="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø¯Ù‡ Ù…Ø´ Ø¹Ø§Ù…Ù„ Ø­Ø³Ø§Ø¨ Ø¹Ù†Ø¯Ù†Ø§ (Demo).";
        return;
      }

      if(type==="gems"){
        const n = Number(amount);
        if(!Number.isFinite(n) || n<=0){
          $("giftErr").style.display="block";
          $("giftErr").textContent="Ø§ÙƒØªØ¨ Ø±Ù‚Ù… Gems ØµØ­ÙŠØ­.";
          return;
        }
        if((u.gems||0) < n){
          $("giftErr").style.display="block";
          $("giftErr").textContent="Gems Ù…Ø´ ÙƒÙØ§ÙŠØ©.";
          return;
        }

        // transfer
        users[u.email].gems = (users[u.email].gems||0) - n;
        users[toEmail].gems = (users[toEmail].gems||0) + n;

        users[toEmail].inbox = users[toEmail].inbox || [];
        users[toEmail].inbox.unshift({ at: now(), text: `ğŸ Ø¬Ø§Ù„Ùƒ ${n} Gems Ù‡Ø¯ÙŠØ© Ù…Ù† ${u.name || u.email}.` });

        users[u.email].inbox = users[u.email].inbox || [];
        users[u.email].inbox.unshift({ at: now(), text: `âœ… Ø§ØªØ¨Ø¹Øª ${n} Gems Ù„Ù€ ${toEmail}.` });

        saveUsers(users);

        $("giftOk").style.display="block";
        $("giftOk").textContent="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯ÙŠØ©.";
        refreshCounts();
        refreshHeaderUser();
        return;
      }

      if(type==="product"){
        const pid = Number(amount);
        const p = productById(pid);
        if(!p){
          $("giftErr").style.display="block";
          $("giftErr").textContent="Product ID ØºÙ„Ø·.";
          return;
        }

        users[toEmail].inbox = users[toEmail].inbox || [];
        users[toEmail].inbox.unshift({ at: now(), text: `ğŸ Ø¬Ø§Ù„Ùƒ Ù‡Ø¯ÙŠØ© (Demo): ${p.name} (#${p.id}) Ù…Ù† ${u.name || u.email}.` });

        users[u.email].inbox = users[u.email].inbox || [];
        users[u.email].inbox.unshift({ at: now(), text: `âœ… Ø§ØªØ¨Ø¹Øª Ù‡Ø¯ÙŠØ© (Demo): #${p.id} Ù„Ù€ ${toEmail}.` });

        saveUsers(users);

        $("giftOk").style.display="block";
        $("giftOk").textContent="âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù‡Ø¯ÙŠØ© (Demo).";
        refreshCounts();
        return;
      }
    };

    /* ===== Menu / Filter / Modals bindings ===== */
    $("menuBtn").onclick = ()=> openDrawer(menuDrawer);
    $("menuClose").onclick = closeAll;

    $("filterBtn").onclick = ()=> openDrawer(filterDrawer);
    $("filterClose").onclick = closeAll;

    $("applyFilterBtn").onclick = ()=>{
      closeAll();
      renderAll();
    };

    document.querySelectorAll("[data-scroll]").forEach(x=>{
      x.addEventListener("click", ()=>{
        const el = document.getElementById(x.dataset.scroll);
        if(!el) return;
        closeAll();
        window.scrollTo({ top: el.getBoundingClientRect().top + window.scrollY - 80, behavior:"smooth" });
      });
    });

    $("openContactRow").onclick = ()=>{ closeAll(); openModal("contactModal"); };
    $("contactClose").onclick = closeAll;

    $("openReviewsRow").onclick = ()=>{ closeAll(); renderReviews(); openModal("reviewsModal"); };
    $("reviewsClose").onclick = closeAll;

    $("openGiftRow").onclick = ()=>{ closeAll(); openModal("giftModal"); };
    $("giftClose").onclick = closeAll;

    $("openInboxRow").onclick = ()=>{ closeAll(); openInbox(); };
    $("openBonusRow").onclick = ()=>{ closeAll(); openBonus(); };

    $("authBtn").onclick = openAuth;
    $("userChip").onclick = ()=> openDrawer(menuDrawer);

    /* ===== Counts / Header ===== */
    function refreshCounts(){
      const u = getCurrentUser();
      $("cartCount").textContent = String(cartCount());
      $("inboxCount").textContent = String(u ? loadInbox().length : 0);
      $("gemsCount").textContent = String(u ? (u.gems || 0) : 0);
    }

    /* ===== Search ===== */
    $("search").addEventListener("input", renderAll);

    /* ===== Init ===== */
    $("year").textContent = new Date().getFullYear();

    window.addEventListener("load", ()=>{
      // ensure nothing opens on refresh
      overlay.classList.remove("show");
      menuDrawer.classList.remove("show");
      filterDrawer.classList.remove("show");
      menuDrawer.setAttribute("aria-hidden","true");
      filterDrawer.setAttribute("aria-hidden","true");
      hideAllPopups();
      closeOverlay();

      // session UI
      refreshHeaderUser();
      refreshCounts();
      renderAll();
    });

    /* ===== Bonus: if user not logged, still show base UI clean ===== */
  </script>
</body>
</html>
